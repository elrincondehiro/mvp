let a=[],s=0;const u=4;let y=i=>{let l=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},lc:0,listen(e){return t.lc=l.push(e),()=>{for(let f=s+u;f<a.length;)a[f]===e?a.splice(f,u):f+=u;let n=l.indexOf(e);~n&&(l.splice(n,1),--t.lc||t.off())}},notify(e,n){let f=!a.length;for(let r of l)a.push(r,t.value,e,n);if(f){for(s=0;s<a.length;s+=u)a[s](a[s+1],a[s+2],a[s+3]);a.length=0}},off(){},set(e){let n=t.value;n!==e&&(t.value=e,t.notify(n))},subscribe(e){let n=t.listen(e);return e(t.value),n},value:i};return t};const o=y({items:[],total:0}),m=i=>{const l=o.get(),t=l.items.findIndex(n=>n.id===i.id);let e;t>=0?(i.quantity<0&&l.items[t].quantity+i.quantity<0&&(i.quantity=-l.items[t].quantity),e={items:[...l.items],total:l.total+i.price*i.quantity},e.items[t].quantity+=i.quantity):(i.quantity<0&&(i.quantity=0),e={items:[...l.items,i],total:l.total+i.price*i.quantity}),o.set(e)};export{m as a,o as c};
